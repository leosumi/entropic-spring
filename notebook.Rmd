---
title: "Simulation of an entropic spring using dissipative particle dynamics"
author: "LÃ©o Sumi"
date: "6 November 2019"
output:
  pdf_document: default
  html_notebook: default
---

```{r include = FALSE}
knitr::opts_chunk$set(echo=FALSE)
```

The simulation contains a single polymer constituted of 14 beads. The simulation runs during 5000 time steps. A force is applied on both ends of the polymer from time step 2000.

A second simulation scenario using sticky beads is also performed. 4 continuous beads of the polymer are replaced by sticky beads that tends to attract each other.

The average end-to-end length of the polymer is calculated for different force magnitude.

```{r}
library(ggplot2)
library(reshape2)
```

```{r}
labels <- c("time", "temperature", "pressure", "V4", "V5", "V6", "w-bead-diffusion", "b-bead-diffusion", "bh-bead-diffusion", "bt-bead-diffusion", "water-end-end-length", "spring-end-end-length")
data0 <- read.table(file = "data/dmpchs.0", col.names = labels)
data10 <- read.table(file = "data/dmpchs.10", col.names = labels)
data30 <- read.table(file = "data/dmpchs.30", col.names = labels)
data50 <- read.table(file = "data/dmpchs.50", col.names = labels)
data70 <- read.table(file = "data/dmpchs.70", col.names = labels)

labels.sticky <- c("time", "temperature", "pressure", "V4", "V5", "V6", "w-bead-diffusion", "b-bead-diffusion", "bh-bead-diffusion", "bt-bead-diffusion", "s-bead-diffusion", "water-end-end-length", "spring-end-end-length")
data0.sticky <- read.table(file = "data/dmpchs.0.sticky", col.names = labels.sticky)
data10.sticky <- read.table(file = "data/dmpchs.10.sticky", col.names = labels.sticky)
data30.sticky <- read.table(file = "data/dmpchs.30.sticky", col.names = labels.sticky)
data50.sticky <- read.table(file = "data/dmpchs.50.sticky", col.names = labels.sticky)
data70.sticky <- read.table(file = "data/dmpchs.70.sticky", col.names = labels.sticky)
```

```{r}
tmp <- data30["time"]
tmp["0"] <- data0["spring.end.end.length"]
tmp["30"] <- data30["spring.end.end.length"]
tmp["50"] <- data50["spring.end.end.length"]
tmp["70"] <- data70["spring.end.end.length"]
data.combine <- melt(tmp, id = "time", variable.name = "force", value.name = "spring.end.end.length")
rm(tmp)

ggplot(data = data.combine, aes(x = time, y = spring.end.end.length, colour = force)) +
  geom_line() +
  labs(title = "Spring streching") +
  ylab("spring end-to-end length")
```

As expected, a greater force will stretch the spring more.

```{r}
tmp <- data50["time"]
tmp["FALSE"] <- data50["spring.end.end.length"]
tmp["TRUE"] <- data50.sticky["spring.end.end.length"]
data50.combine <- melt(tmp, id = "time", variable.name = "sticky", value.name = "spring.end.end.length")
rm(tmp)
data50.combine["force"] <- 50

tmp <- data10["time"]
tmp["FALSE"] <- data10["spring.end.end.length"]
tmp["TRUE"] <- data10.sticky["spring.end.end.length"]
data10.combine <- melt(tmp, id = "time", variable.name = "sticky", value.name = "spring.end.end.length")
rm(tmp)
data10.combine["force"] <- 10

tmp <- data0["time"]
tmp["FALSE"] <- data0["spring.end.end.length"]
tmp["TRUE"] <- data0.sticky["spring.end.end.length"]
data0.combine <- melt(tmp, id = "time", variable.name = "sticky", value.name = "spring.end.end.length")
rm(tmp)
data0.combine["force"] <- 0

data.combine <- rbind(data50.combine, data10.combine, data0.combine)
data.combine$force <- as.factor(data.combine$force)

ggplot(data = data.combine, aes(x = time, y = spring.end.end.length, colour = sticky, linetype = force)) + 
  geom_line() +
  labs(title = "Spring streching with and without sticky beads") +
  ylab("spring end-to-end length")
```

A force of 50 or 10 was applied from time 2000 to 5000. Before the force is applied, we can see that the spring containing sticky beads has a smaller end-to-end length. After the force is applied, the effect of the sticky beads is negligible compared to the effect of the force in the case of a large applied force. If a smaller force is applied to the spring, like a force of 10, the sticky beads have a greater effect.

The applied force will overstretch the spring the first time steps after application. For this reason, the average end-to-end length will be calculated from time 2500. 

```{r}
data <- read.csv(file = "data.csv")

ggplot(data = data, aes(x = force, y = length, colour = sticky)) +
  geom_point() +
  labs(title = "Average end-to-end length of the spring") +
  ylab("average end-to-end length")
```

A too large force will disrupt the spring. We can also see that the sticky bead effect is mostly visible when the force is small (dot overlapping).

```{r}
data.small <- subset(data, force < 25)

ggplot(data = data.small, aes(x = length, y = force, colour = sticky)) +
  geom_line() +
  labs(title = "Necessary force to obtain an average end-to-end length") +
  xlab("average end-to-end length")
```

The spring constant is not constant, but it seems to be similar between the spring containing sticky beads and the one containing none. The plot shows that the spring constant increase with respect to the average end-to-end length.

The source code is available at <https://github.com/leosumi/entropic-spring>.
